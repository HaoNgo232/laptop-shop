<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36" version="28.0.9">
  <diagram name="Order Flow Sequence" id="f2d9n5jo6-LodYtrp6zb">
    <mxGraphModel dx="1188" dy="626" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-148" value="Client/Frontend" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="1" vertex="1">
          <mxGeometry x="60" y="50" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-149" value="" style="endArrow=none;dashed=1;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="70" y="140" as="sourcePoint" />
            <mxPoint x="70" y="1050" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-150" value="OrdersController" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="230" y="60" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-151" value="" style="endArrow=none;dashed=1;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="280" y="140" as="sourcePoint" />
            <mxPoint x="280" y="1040" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-152" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="70" y="170" as="sourcePoint" />
            <mxPoint x="280" y="170" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-153" value="Post /api/orders" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="110" y="140" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-154" value="&lt;div&gt;&lt;span style=&quot;text-wrap-mode: nowrap;&quot;&gt;Header: Authorization: &quot;Token&quot;&lt;/span&gt;&lt;/div&gt;&lt;span style=&quot;text-wrap-mode: nowrap;&quot;&gt;Request Body {&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;text-wrap-mode: nowrap;&quot;&gt;shippingAddress,&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;text-wrap-mode: nowrap;&quot;&gt;paymentMethod,&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;text-wrap-mode: nowrap;&quot;&gt;note(tùy chọn)&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); text-wrap-mode: nowrap;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="90" y="180" width="165" height="110" as="geometry" />
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-155" value="OrdersService" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="400" y="60" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-156" value="" style="endArrow=classic;html=1;rounded=0;entryX=0.95;entryY=0.993;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" target="wxuzcOG6F8mb4mBLS7Le-158" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="280" y="249.74" as="sourcePoint" />
            <mxPoint x="440" y="249.74" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-157" value="" style="endArrow=none;dashed=1;html=1;rounded=0;entryX=0.154;entryY=1.006;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" edge="1" target="zo_s3Sdup5ROUhnuKX8M-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="447.5" y="100" as="sourcePoint" />
            <mxPoint x="450" y="1040" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-158" value="create(userId, createOrderDto)" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="270" y="220" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-160" value="" style="curved=1;endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="280" y="200" as="sourcePoint" />
            <mxPoint x="280" y="210" as="targetPoint" />
            <Array as="points">
              <mxPoint x="300" y="200" />
              <mxPoint x="290" y="210" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-161" value="Extract userId từ token&amp;nbsp;&lt;div&gt;(phần này thực hiện tại Guard)&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="wxuzcOG6F8mb4mBLS7Le-160" connectable="0" vertex="1">
          <mxGeometry x="0.1753" y="-1" relative="1" as="geometry">
            <mxPoint x="65" y="-24" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-162" value="CartService" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="560" y="60" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-163" value="" style="endArrow=none;dashed=1;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="wxuzcOG6F8mb4mBLS7Le-162" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="560" y="100" as="sourcePoint" />
            <mxPoint x="610" y="760" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-165" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="450" y="270" as="sourcePoint" />
            <mxPoint x="610" y="270" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-166" value="findCart(userId)" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="480" y="238" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-167" value="Lấy thông tin giỏ hàng:" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="470" y="220" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-168" value="CartRepository" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1070" y="60" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-169" value="" style="endArrow=none;dashed=1;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1120" y="100" as="sourcePoint" />
            <mxPoint x="1125" y="880" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-170" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="610" y="290" as="sourcePoint" />
            <mxPoint x="1120" y="290" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-171" value="findOne({ where: {userId} })" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="625" y="260" width="170" height="30" as="geometry" />
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-172" value="Database" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" parent="1" vertex="1">
          <mxGeometry x="1290" y="50" width="60" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-173" value="" style="endArrow=none;dashed=1;html=1;rounded=0;entryX=0.951;entryY=1.004;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" edge="1" target="zo_s3Sdup5ROUhnuKX8M-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1320" y="110" as="sourcePoint" />
            <mxPoint x="1320" y="880" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-174" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1120" y="320" as="sourcePoint" />
            <mxPoint x="1320" y="320" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-175" value="Tạo tuy vấn SQL:" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="650" y="238" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-176" value="SELECT * FROM cart&amp;nbsp;&lt;div&gt;WHERE userId = ?&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1150" y="273" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-177" value="" style="endArrow=classic;html=1;rounded=0;dashed=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1320" y="360" as="sourcePoint" />
            <mxPoint x="448.1818181818182" y="360" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-178" value="Trả về thông tin giỏ hàng" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="795" y="330" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-181" value="" style="curved=1;endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="450" y="400" as="sourcePoint" />
            <mxPoint x="450" y="410" as="targetPoint" />
            <Array as="points">
              <mxPoint x="470" y="400" />
              <mxPoint x="460" y="410" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-182" value="Kiểm tra số lượng và&amp;nbsp;&lt;div&gt;tính tổng tiền ban đầu&lt;/div&gt;&lt;div&gt;&amp;nbsp;(originalAmount)&amp;nbsp;&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="wxuzcOG6F8mb4mBLS7Le-181" connectable="0" vertex="1">
          <mxGeometry x="0.1753" y="-1" relative="1" as="geometry">
            <mxPoint x="70" y="-13" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-183" value="DiscountService" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="710" y="60" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-184" value="" style="endArrow=none;dashed=1;html=1;rounded=0;entryX=0.687;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" target="wxuzcOG6F8mb4mBLS7Le-226" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="757.5" y="100" as="sourcePoint" />
            <mxPoint x="760" y="880" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-185" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="450" y="460" as="sourcePoint" />
            <mxPoint x="760" y="460" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-186" value="Tính toán giảm giá theo rank user:&lt;div&gt;caculate(userId,&amp;nbsp;&lt;span style=&quot;background-color: rgb(255, 255, 255); font-size: 11px; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;originalAmount&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;)&lt;/span&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="500" y="420" width="210" height="40" as="geometry" />
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-188" value="" style="endArrow=classic;html=1;rounded=0;dashed=1;exitX=1.01;exitY=1.014;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="760.5" y="500" as="sourcePoint" />
            <mxPoint x="449.5" y="500" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-189" value="Trả về tổng tiền cuối (sau tính toán giảm giá)" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="490" y="470" width="260" height="30" as="geometry" />
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-190" value="" style="curved=1;endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="450" y="530" as="sourcePoint" />
            <mxPoint x="450" y="540" as="targetPoint" />
            <Array as="points">
              <mxPoint x="470" y="530" />
              <mxPoint x="460" y="540" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-191" value="Tạo thông tin đơn hàng" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="wxuzcOG6F8mb4mBLS7Le-190" connectable="0" vertex="1">
          <mxGeometry x="0.1753" y="-1" relative="1" as="geometry">
            <mxPoint x="65" y="-4" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-192" value="DataSource" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="930" y="60" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-193" value="" style="endArrow=none;dashed=1;html=1;rounded=0;entryX=0.646;entryY=0.998;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" edge="1" target="zo_s3Sdup5ROUhnuKX8M-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="980" y="100" as="sourcePoint" />
            <mxPoint x="985" y="880" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-195" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="450" y="600" as="sourcePoint" />
            <mxPoint x="990" y="600" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-196" value="Tạo tuy vấn giao dịch" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="wxuzcOG6F8mb4mBLS7Le-195" vertex="1" connectable="0">
          <mxGeometry x="-0.2645" relative="1" as="geometry">
            <mxPoint x="66" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-197" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="990" y="620" as="sourcePoint" />
            <mxPoint x="1320" y="620" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-200" value="&lt;div&gt;INSERT INTO order&lt;/div&gt;&lt;div&gt;(id, user_id, total_amount, status, payment_method, ...)&lt;/div&gt;&lt;div&gt;VALUES (?, ?, ?, &#39;PENDING&#39;, ?, ...)&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="wxuzcOG6F8mb4mBLS7Le-197" vertex="1" connectable="0">
          <mxGeometry x="0.1049" relative="1" as="geometry">
            <mxPoint x="3" y="-30" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-202" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="990" y="680" as="sourcePoint" />
            <mxPoint x="1321" y="680" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-203" value="&lt;div style=&quot;font-size: 12px; background-color: rgb(236, 236, 236);&quot;&gt;&lt;div style=&quot;background-color: rgb(236, 236, 236);&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="wxuzcOG6F8mb4mBLS7Le-202" vertex="1" connectable="0">
          <mxGeometry x="0.1049" relative="1" as="geometry">
            <mxPoint x="3" y="-30" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-204" value="&lt;div&gt;INSERT INTO order_item&lt;/div&gt;&lt;div&gt;(order_id, product_id, quantity, price)&lt;/div&gt;&lt;div&gt;VALUES (?, ?, ?, ?), (?, ?, ?, ?), ...&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="wxuzcOG6F8mb4mBLS7Le-202" vertex="1" connectable="0">
          <mxGeometry x="-0.0353" y="-1" relative="1" as="geometry">
            <mxPoint x="15" y="-31" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-206" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="990" y="720" as="sourcePoint" />
            <mxPoint x="1321" y="720" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-207" value="&lt;div style=&quot;font-size: 12px; background-color: rgb(236, 236, 236);&quot;&gt;&lt;div style=&quot;background-color: rgb(236, 236, 236);&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="wxuzcOG6F8mb4mBLS7Le-206" vertex="1" connectable="0">
          <mxGeometry x="0.1049" relative="1" as="geometry">
            <mxPoint x="3" y="-30" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-208" value="&lt;div style=&quot;font-size: 12px; background-color: rgb(236, 236, 236);&quot;&gt;&lt;br&gt;&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="wxuzcOG6F8mb4mBLS7Le-206" vertex="1" connectable="0">
          <mxGeometry x="-0.0353" y="-1" relative="1" as="geometry">
            <mxPoint x="25" y="-31" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-209" value="&lt;div&gt;UPDATE product SET stock_quantity = stock_quantity - ?&lt;/div&gt;&lt;div&gt;WHERE id IN (?, ?, ...)&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="wxuzcOG6F8mb4mBLS7Le-206" vertex="1" connectable="0">
          <mxGeometry x="-0.0176" y="1" relative="1" as="geometry">
            <mxPoint x="22" y="-19" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-210" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="990" y="750" as="sourcePoint" />
            <mxPoint x="1320" y="750" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-211" value="&lt;div style=&quot;font-size: 12px; background-color: rgb(236, 236, 236);&quot;&gt;&lt;div style=&quot;background-color: rgb(236, 236, 236);&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="wxuzcOG6F8mb4mBLS7Le-210" vertex="1" connectable="0">
          <mxGeometry x="0.1049" relative="1" as="geometry">
            <mxPoint x="3" y="-30" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-212" value="&lt;div style=&quot;font-size: 12px; background-color: rgb(236, 236, 236);&quot;&gt;&lt;br&gt;&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="wxuzcOG6F8mb4mBLS7Le-210" vertex="1" connectable="0">
          <mxGeometry x="-0.0353" y="-1" relative="1" as="geometry">
            <mxPoint x="25" y="-31" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-214" value="DELETE FROM cart_item WHERE cart_id = ?" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="wxuzcOG6F8mb4mBLS7Le-210" vertex="1" connectable="0">
          <mxGeometry x="-0.1045" relative="1" as="geometry">
            <mxPoint x="18" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-215" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="991" y="777.65" as="sourcePoint" />
            <mxPoint x="1321" y="777.65" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-217" value="COMMIT GIAO DỊCH" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1090" y="748" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-220" value="" style="endArrow=classic;html=1;rounded=0;dashed=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="980" y="810" as="sourcePoint" />
            <mxPoint x="450" y="810" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-221" value="Trả về thông tin đơn hàng (order)" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="580" y="778" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-222" value="" style="endArrow=classic;html=1;rounded=0;dashed=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1321" y="800" as="sourcePoint" />
            <mxPoint x="990" y="800" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-223" value="Giao dịch thành công" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="wxuzcOG6F8mb4mBLS7Le-222" vertex="1" connectable="0">
          <mxGeometry x="-0.0985" y="-3" relative="1" as="geometry">
            <mxPoint x="-8" y="-7" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-226" value="alt" style="shape=umlFrame;whiteSpace=wrap;html=1;pointerEvents=0;" parent="1" vertex="1">
          <mxGeometry x="340" y="840" width="615" height="140" as="geometry" />
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-227" value="PaymentsService" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="825" y="60" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-228" value="" style="endArrow=none;dashed=1;html=1;rounded=0;entryX=0.884;entryY=0.994;entryDx=0;entryDy=0;entryPerimeter=0;exitX=0.574;exitY=1.066;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="wxuzcOG6F8mb4mBLS7Le-227" target="wxuzcOG6F8mb4mBLS7Le-226" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="873.75" y="100" as="sourcePoint" />
            <mxPoint x="876.25" y="880" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-230" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;exitX=0.002;exitY=0.555;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.997;entryY=0.535;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="wxuzcOG6F8mb4mBLS7Le-226" target="wxuzcOG6F8mb4mBLS7Le-226" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="370" y="880" as="sourcePoint" />
            <mxPoint x="420" y="830" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-231" value="&lt;b&gt;if [paymentMethod = Sepay_QR]&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="340" y="890" width="210" height="30" as="geometry" />
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-232" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="450" y="860" as="sourcePoint" />
            <mxPoint x="880" y="860" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-233" value="generateQRcode(order, &quot;SEPAY_QR&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212)); color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&quot;)&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="wxuzcOG6F8mb4mBLS7Le-232" vertex="1" connectable="0">
          <mxGeometry x="-0.2645" relative="1" as="geometry">
            <mxPoint x="66" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-236" value="" style="endArrow=classic;html=1;rounded=0;dashed=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="880" y="890" as="sourcePoint" />
            <mxPoint x="450" y="890" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-237" value="QRCodeResponse" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="wxuzcOG6F8mb4mBLS7Le-236" vertex="1" connectable="0">
          <mxGeometry x="0.1122" y="-1" relative="1" as="geometry">
            <mxPoint y="-9" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-238" value="" style="curved=1;endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="450" y="950" as="sourcePoint" />
            <mxPoint x="450" y="960" as="targetPoint" />
            <Array as="points">
              <mxPoint x="470" y="950" />
              <mxPoint x="460" y="960" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-239" value="Bỏ qua tạo QRcode" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="wxuzcOG6F8mb4mBLS7Le-238" connectable="0" vertex="1">
          <mxGeometry x="0.1753" y="-1" relative="1" as="geometry">
            <mxPoint x="55" y="-4" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-240" value="&lt;b style=&quot;forced-color-adjust: none; color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: center; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: nowrap; background-color: rgb(236, 236, 236); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;if [paymentMethod = COD]&lt;/b&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="360" y="920" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-241" value="" style="endArrow=classic;html=1;rounded=0;dashed=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="450" y="1010" as="sourcePoint" />
            <mxPoint x="280" y="1010" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-242" value="{ order, qrCode?, discountInfo }" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="wxuzcOG6F8mb4mBLS7Le-241" vertex="1" connectable="0">
          <mxGeometry x="0.1122" y="-1" relative="1" as="geometry">
            <mxPoint x="10" y="-9" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-245" value="" style="endArrow=classic;html=1;rounded=0;dashed=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="277.5" y="1030" as="sourcePoint" />
            <mxPoint x="67.5" y="1030" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wxuzcOG6F8mb4mBLS7Le-246" value="201 - user create successfully" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="wxuzcOG6F8mb4mBLS7Le-245" vertex="1" connectable="0">
          <mxGeometry x="0.1122" y="-1" relative="1" as="geometry">
            <mxPoint x="10" y="-9" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="zo_s3Sdup5ROUhnuKX8M-1" value="alt" style="shape=umlFrame;whiteSpace=wrap;html=1;pointerEvents=0;" vertex="1" parent="1">
          <mxGeometry x="280" y="560" width="1090" height="570" as="geometry" />
        </mxCell>
        <mxCell id="zo_s3Sdup5ROUhnuKX8M-2" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;exitX=0.002;exitY=0.555;exitDx=0;exitDy=0;exitPerimeter=0;entryX=1.002;entryY=0.468;entryDx=0;entryDy=0;entryPerimeter=0;fontStyle=1" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="277.82" y="1046.24" as="sourcePoint" />
            <mxPoint x="1369.9999999999998" y="1040" as="targetPoint" />
            <Array as="points">
              <mxPoint x="817.82" y="1046.24" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="zo_s3Sdup5ROUhnuKX8M-3" value="&lt;b&gt;if [Giao dịch thành công]&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="345" y="560" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="zo_s3Sdup5ROUhnuKX8M-4" value="&lt;b&gt;else [Giao dịch thất bại]&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="280" y="1040" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="zo_s3Sdup5ROUhnuKX8M-5" value="" style="endArrow=classic;html=1;rounded=0;dashed=1;entryX=1.006;entryY=0.333;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1319.04" y="1064.72" as="sourcePoint" />
            <mxPoint x="444.99999999999983" y="1064.71" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="zo_s3Sdup5ROUhnuKX8M-6" value="Giao dịch thất bại" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="zo_s3Sdup5ROUhnuKX8M-5">
          <mxGeometry x="-0.0985" y="-3" relative="1" as="geometry">
            <mxPoint x="-8" y="-7" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="zo_s3Sdup5ROUhnuKX8M-8" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="450" y="1100" as="sourcePoint" />
            <mxPoint x="1320" y="1100" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="zo_s3Sdup5ROUhnuKX8M-9" value="ROLLBACK" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="zo_s3Sdup5ROUhnuKX8M-8">
          <mxGeometry x="-0.2645" relative="1" as="geometry">
            <mxPoint x="66" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
